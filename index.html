<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SWARG Security Vault</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Fonts + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background:#0a0a0f; color:white; font-family:Inter,sans-serif; }
    .glass { background:rgba(20,20,30,.85); border:1px solid rgba(255,255,255,.1); border-radius:18px; }
    .hidden { display:none; }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">

  <!-- HEADER -->
  <h1 class="text-5xl font-bold mb-2">SWARG</h1>
  <div class="mb-8 text-yellow-400 font-semibold">by Amar Kumar</div>

  <!-- PASSWORD -->
  <div class="glass p-6 w-full max-w-xl mb-6">
    <h2 class="text-xl font-semibold mb-4">Master Password</h2>
    <input id="master-password" type="password"
      class="w-full p-3 rounded bg-black border border-gray-600"
      placeholder="Enter master password">
  </div>

  <!-- TABS -->
  <div class="flex gap-2 mb-6">
    <button class="tab-button bg-blue-600 px-4 py-2 rounded" data-tab="encrypt">Encrypt</button>
    <button class="tab-button bg-gray-700 px-4 py-2 rounded" data-tab="decrypt">Decrypt</button>
  </div>

  <!-- ENCRYPT -->
  <div id="encrypt-tab" class="glass p-6 w-full max-w-xl">
    <textarea id="input-text"
      class="w-full p-3 rounded bg-black border border-gray-600 mb-4"
      rows="4"
      placeholder="Enter text to encrypt"></textarea>

    <div id="encrypted-output" class="p-3 bg-black border border-gray-600 rounded mb-4 hidden"></div>

    <button id="encrypt-btn"
      class="bg-cyan-600 px-4 py-2 rounded w-full">Encrypt</button>
  </div>

  <!-- DECRYPT -->
  <div id="decrypt-tab" class="glass p-6 w-full max-w-xl hidden">
    <textarea id="encrypted-token"
      class="w-full p-3 rounded bg-black border border-gray-600 mb-4"
      rows="4"
      placeholder="Paste encrypted token"></textarea>

    <div id="decrypted-output" class="p-3 bg-black border border-gray-600 rounded mb-4 hidden"></div>

    <button id="decrypt-btn"
      class="bg-purple-600 px-4 py-2 rounded w-full">Decrypt</button>
  </div>

  <!-- TOAST -->
  <div id="toast-container" class="fixed bottom-6 left-1/2 -translate-x-1/2"></div>

<script>
/* ========= CONFIG ========= */
const CONFIG = {
  PBKDF2_ITERATIONS: 200000,
  SALT_LENGTH: 16,
  IV_LENGTH: 12
};

/* ========= STATE ========= */
const state = {
  password: '',
  isProcessing: false
};

/* ========= INIT ========= */
document.addEventListener("DOMContentLoaded", () => {
  setupEvents();
  showToast("SWARG ready");
});

/* ========= EVENTS ========= */
function setupEvents() {
  document.getElementById("encrypt-btn").addEventListener("click", encryptData);
  document.getElementById("decrypt-btn").addEventListener("click", decryptData);

  document.getElementById("master-password").addEventListener("input", e => {
    state.password = e.target.value;
  });

  document.querySelectorAll(".tab-button").forEach(btn => {
    btn.addEventListener("click", () => switchTab(btn.dataset.tab));
  });
}

/* ========= TABS ========= */
function switchTab(tab) {
  document.getElementById("encrypt-tab").classList.toggle("hidden", tab !== "encrypt");
  document.getElementById("decrypt-tab").classList.toggle("hidden", tab !== "decrypt");
}

/* ========= ENCRYPT ========= */
async function encryptData() {
  if (state.isProcessing) return;

  const text = document.getElementById("input-text").value.trim();
  const password = state.password;

  if (!password || password.length < 6) {
    showToast("Weak password", "error");
    return;
  }
  if (!text) {
    showToast("Enter text", "error");
    return;
  }

  state.isProcessing = true;

  try {
    const salt = crypto.getRandomValues(new Uint8Array(CONFIG.SALT_LENGTH));
    const iv   = crypto.getRandomValues(new Uint8Array(CONFIG.IV_LENGTH));

    const enc = new TextEncoder();
    const baseKey = await crypto.subtle.importKey(
      "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
    );

    const key = await crypto.subtle.deriveKey(
      { name: "PBKDF2", salt, iterations: CONFIG.PBKDF2_ITERATIONS, hash: "SHA-256" },
      baseKey, { name: "AES-GCM", length: 256 }, false, ["encrypt"]
    );

    const encrypted = await crypto.subtle.encrypt(
      { name: "AES-GCM", iv }, key, enc.encode(text)
    );

    const tokenData = {
      s: btoa(String.fromCharCode(...salt)),
      i: btoa(String.fromCharCode(...iv)),
      d: btoa(String.fromCharCode(...new Uint8Array(encrypted)))
    };

    const token = btoa(unescape(encodeURIComponent(JSON.stringify(tokenData))));

    const out = document.getElementById("encrypted-output");
    out.textContent = token;
    out.classList.remove("hidden");

    showToast("Encrypted");

  } catch (e) {
    console.error(e);
    showToast("Encrypt failed", "error");
  }

  state.isProcessing = false;
}

/* ========= DECRYPT ========= */
async function decryptData() {
  if (state.isProcessing) return;

  const token = document.getElementById("encrypted-token").value.trim();
  const password = state.password;

  if (!password || password.length < 6) {
    showToast("Weak password", "error");
    return;
  }
  if (!token) {
    showToast("Paste token", "error");
    return;
  }

  state.isProcessing = true;

  try {
    const json = decodeURIComponent(escape(atob(token)));
    const tokenData = JSON.parse(json);

    const salt = Uint8Array.from(atob(tokenData.s), c => c.charCodeAt(0));
    const iv   = Uint8Array.from(atob(tokenData.i), c => c.charCodeAt(0));
    const data = Uint8Array.from(atob(tokenData.d), c => c.charCodeAt(0));

    const enc = new TextEncoder();
    const baseKey = await crypto.subtle.importKey(
      "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
    );

    const key = await crypto.subtle.deriveKey(
      { name: "PBKDF2", salt, iterations: CONFIG.PBKDF2_ITERATIONS, hash: "SHA-256" },
      baseKey, { name: "AES-GCM", length: 256 }, false, ["decrypt"]
    );

    const decrypted = await crypto.subtle.decrypt(
      { name: "AES-GCM", iv }, key, data
    );

    const text = new TextDecoder().decode(decrypted);

    const out = document.getElementById("decrypted-output");
    out.textContent = text;
    out.classList.remove("hidden");

    showToast("Decrypted");

  } catch (e) {
    console.error(e);
    showToast("Wrong password or token", "error");
  }

  state.isProcessing = false;
}

/* ========= TOAST ========= */
function showToast(msg, type="ok") {
  const c = document.getElementById("toast-container");
  const d = document.createElement("div");
  d.className = "px-4 py-2 rounded bg-black border border-gray-600 mb-2";
  d.textContent = msg;
  c.appendChild(d);
  setTimeout(()=>d.remove(),2500);
}
</script>
</body>
    </html>
